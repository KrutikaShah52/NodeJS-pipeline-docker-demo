node{
    def app
    def tag = "latest"

    stage('Checkout'){
        checkout scm
    }
    stage('Build Docker image'){
         app = docker.build("nodejs-docker-app")
    }
    stage('test') {
        def myTestContainer = docker.image('nodejs-docker-app:latest')
        myTestContainer.pull()
        myTestContainer.inside {
            sh 'npm install'
            sh 'npm test'
        }
    }
}
